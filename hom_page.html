<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–§–∞–∫—Ç–æ—Ä–∏–∞–ª-–§–µ—Å—Ç! –£—á–∏–º —Ñ–∞–∫—Ç–æ—Ä–∏–∞–ª—ã</title>
    <style>
        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background-color: #fff5f5;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .game-container {
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            padding: 30px;
            max-width: 600px;
            width: 100%;
            text-align: center;
        }

        h1 {
            color: #ff7675;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .level-info {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            font-size: 18px;
            color: #6c5ce7;
        }

        .game-area {
            margin: 20px 0;
        }

        .question-box {
            background-color: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
        }

        .question {
            font-size: 48px;
            font-weight: bold;
            color: #e84393;
            margin: 10px 0;
        }

        #factorial-explanation {
            font-size: 18px;
            color: #636e72;
            margin-top: 10px;
        }

        .answers {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .answer-btn {
            background-color: #a29bfe;
            color: white;
            border: none;
            border-radius: 10px;
            padding: 15px;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .answer-btn:hover {
            background-color: #6c5ce7;
            transform: scale(1.05);
        }

        .feedback {
            min-height: 80px;
        }

        #feedback-text {
            font-size: 20px;
            margin-bottom: 15px;
            color: #00b894;
        }

        #next-btn {
            background-color: #55efc4;
            color: white;
            border: none;
            border-radius: 10px;
            padding: 12px 25px;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s;
        }

        #next-btn:hover {
            background-color: #00b894;
        }

        .help-section {
            margin-top: 20px;
        }

        #help-btn {
            background-color: #fd79a8;
            color: white;
            border: none;
            border-radius: 10px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }

        #help-text {
            background-color: #dfe6e9;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            text-align: left;
        }

        .hidden {
            display: none;
        }

        .correct {
            background-color: #55efc4 !important;
            animation: bounce 0.5s;
        }

        .incorrect {
            background-color: #ff7675 !important;
        }

        @keyframes bounce {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
            }
        }

        .explanation-btn {
            background-color: #ffeaa7;
            color: #6c5ce7;
            border: none;
            border-radius: 10px;
            padding: 8px 15px;
            font-size: 14px;
            cursor: pointer;
            margin-top: 10px;
        }
    </style>
</head>

<body>
    <div class="game-container">
        <h1>üéâ –§–ê–ö–¢–û–†–ò–ê–õ-–§–ï–°–¢! ‚ú®</h1>
        <div class="level-info">
            <p>–£—Ä–æ–≤–µ–Ω—å: <span id="level">1</span></p>
            <p>–û—á–∫–∏: <span id="score">0</span></p>
            <p>–†–µ–∫–æ—Ä–¥: <span id="high-score">0</span></p>
        </div>

        <div class="game-area">
            <div class="question-box">
                <p>–ß–µ–º—É —Ä–∞–≤–µ–Ω —Ñ–∞–∫—Ç–æ—Ä–∏–∞–ª —á–∏—Å–ª–∞:</p>
                <div id="question" class="question">5</div>
                <div id="factorial-explanation" class="hidden">
                    <p>5! = 5 √ó 4 √ó 3 √ó 2 √ó 1 = 120</p>
                </div>
            </div>

            <div class="answers">
                <!-- –û—Ç–≤–µ—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —á–µ—Ä–µ–∑ JavaScript -->
            </div>

            <div class="feedback">
                <p id="feedback-text"></p>
                <button id="next-btn" class="hidden">–î–∞–ª—å—à–µ ‚Üí</button>
            </div>
        </div>

        <div class="help-section">
            <button id="help-btn">–ü–æ–º–æ—â—å üí°</button>
            <div id="help-text" class="hidden">
                <p>–§–∞–∫—Ç–æ—Ä–∏–∞–ª —á–∏—Å–ª–∞ - —ç—Ç–æ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –≤—Å–µ—Ö –Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã—Ö —á–∏—Å–µ–ª –æ—Ç 1 –¥–æ —ç—Ç–æ–≥–æ —á–∏—Å–ª–∞.</p>
                <p>–û–±–æ–∑–Ω–∞—á–∞–µ—Ç—Å—è –≤–æ—Å–∫–ª–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º –∑–Ω–∞–∫–æ–º: n!</p>
                <p>–ü—Ä–∏–º–µ—Ä—ã:</p>
                <ul>
                    <li>3! = 3 √ó 2 √ó 1 = 6</li>
                    <li>4! = 4 √ó 3 √ó 2 √ó 1 = 24</li>
                    <li>5! = 5 √ó 4 √ó 3 √ó 2 √ó 1 = 120</li>
                </ul>
                <p>–ó–∞–ø–æ–º–Ω–∏: 0! = 1 (—ç—Ç–æ –æ—Å–æ–±—ã–π —Å–ª—É—á–∞–π)</p>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
            const questionElement = document.getElementById('question');
            const answersContainer = document.querySelector('.answers');
            const feedbackText = document.getElementById('feedback-text');
            const nextButton = document.getElementById('next-btn');
            const scoreElement = document.getElementById('score');
            const levelElement = document.getElementById('level');
            const highScoreElement = document.getElementById('high-score');
            const helpButton = document.getElementById('help-btn');
            const helpText = document.getElementById('help-text');
            const factorialExplanation = document.getElementById('factorial-explanation');

            // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
            let score = 0;
            let level = 1;
            let highScore = localStorage.getItem('factorialHighScore') || 0;
            let correctAnswer;
            let currentNumber;

            // –ù–∞—á–∞–ª–æ –∏–≥—Ä—ã
            highScoreElement.textContent = highScore;
            startGame();

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            helpButton.addEventListener('click', toggleHelp);
            nextButton.addEventListener('click', nextQuestion);

            // –§—É–Ω–∫—Ü–∏–∏ –∏–≥—Ä—ã
            function startGame() {
                score = 0;
                level = 1;
                updateScore();
                generateQuestion();
            }

            function generateQuestion() {
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —á–∏—Å–ª–æ –¥–ª—è —Ñ–∞–∫—Ç–æ—Ä–∏–∞–ª–∞ (–æ—Ç 0 –¥–æ 8 –¥–ª—è –Ω–∞—á–∞–ª–∞)
                // –° —É–≤–µ–ª–∏—á–µ–Ω–∏–µ–º —É—Ä–æ–≤–Ω—è —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω
                let maxNumber = Math.min(3 + level, 8); // –ú–∞–∫—Å–∏–º—É–º 8, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∏—Ö —á–∏—Å–µ–ª
                currentNumber = Math.floor(Math.random() * (maxNumber + 1));

                questionElement.textContent = currentNumber;
                correctAnswer = calculateFactorial(currentNumber);

                // –°–∫—Ä—ã–≤–∞–µ–º –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ
                factorialExplanation.classList.add('hidden');

                generateAnswers(currentNumber, correctAnswer);
            }

            function generateAnswers(number, correctAnswer) {
                answersContainer.innerHTML = '';

                // –°–æ–∑–¥–∞–µ–º –º–∞—Å—Å–∏–≤ –≤–æ–∑–º–æ–∂–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
                let answers = [correctAnswer];

                // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
                while (answers.length < 4) {
                    let wrongAnswer;

                    // –†–∞–∑–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
                    if (number > 0) {
                        // –í–∞—Ä–∏–∞–Ω—Ç 1: –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –æ–¥–∏–Ω –º–Ω–æ–∂–∏—Ç–µ–ª—å
                        if (Math.random() > 0.5) {
                            wrongAnswer = calculateFactorial(number - 1) * number;
                        }
                        // –í–∞—Ä–∏–∞–Ω—Ç 2: –¥–æ–±–∞–≤–∏—Ç—å/—É–±–∞–≤–∏—Ç—å —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ
                        else {
                            let deviation = Math.floor(Math.random() * 10) + 1;
                            if (Math.random() > 0.5) deviation = -deviation;
                            wrongAnswer = correctAnswer + deviation;
                            if (wrongAnswer < 0) wrongAnswer = 0;
                        }
                    } else {
                        // –î–ª—è 0! —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
                        wrongAnswer = Math.floor(Math.random() * 5);
                        if (wrongAnswer === 1) wrongAnswer = 2; // 1 - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
                    }

                    // –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –æ—Ç–≤–µ—Ç —É–Ω–∏–∫–∞–ª–µ–Ω –∏ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–π
                    if (!answers.includes(wrongAnswer) && wrongAnswer >= 0) {
                        answers.push(wrongAnswer);
                    }
                }

                // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –æ—Ç–≤–µ—Ç—ã
                answers = shuffleArray(answers);

                // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫–∏ —Å –æ—Ç–≤–µ—Ç–∞–º–∏
                answers.forEach(answer => {
                    const button = document.createElement('button');
                    button.className = 'answer-btn';
                    button.textContent = answer;
                    button.addEventListener('click', () => checkAnswer(answer));
                    answersContainer.appendChild(button);
                });

                // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É "–ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ—à–µ–Ω–∏–µ"
                const explanationBtn = document.createElement('button');
                explanationBtn.className = 'explanation-btn';
                explanationBtn.textContent = '–ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ—à–µ–Ω–∏–µ';
                explanationBtn.addEventListener('click', showExplanation);
                answersContainer.appendChild(explanationBtn);
            }

            function showExplanation() {
                if (currentNumber === 0) {
                    factorialExplanation.innerHTML = '<p>0! = 1 (–ø–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—é)</p>';
                } else {
                    let explanation = `${currentNumber}! = `;
                    for (let i = currentNumber; i >= 1; i--) {
                        explanation += i;
                        if (i > 1) explanation += ' √ó ';
                    }
                    explanation += ` = ${correctAnswer}`;
                    factorialExplanation.innerHTML = `<p>${explanation}</p>`;
                }
                factorialExplanation.classList.remove('hidden');
            }

            function checkAnswer(selectedAnswer) {
                // –û—Ç–∫–ª—é—á–∞–µ–º –≤—Å–µ –∫–Ω–æ–ø–∫–∏ –æ—Ç–≤–µ—Ç–æ–≤
                const answerButtons = document.querySelectorAll('.answer-btn');
                answerButtons.forEach(btn => {
                    btn.disabled = true;
                    if (parseInt(btn.textContent) === correctAnswer) {
                        btn.classList.add('correct');
                    } else if (parseInt(btn.textContent) === parseInt(selectedAnswer) && parseInt(selectedAnswer) !== correctAnswer) {
                        btn.classList.add('incorrect');
                    }
                });

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Ç–≤–µ—Ç
                if (parseInt(selectedAnswer) === correctAnswer) {
                    feedbackText.textContent = getRandomSuccessMessage();
                    score += level * 10;
                    updateScore();

                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–∫–æ—Ä–¥
                    if (score > highScore) {
                        highScore = score;
                        highScoreElement.textContent = highScore;
                        localStorage.setItem('factorialHighScore', highScore);
                    }
                } else {
                    feedbackText.textContent = `–û–π! –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: ${correctAnswer}. ${getRandomHint()}`;
                    showExplanation();
                }

                nextButton.classList.remove('hidden');
            }

            function nextQuestion() {
                feedbackText.textContent = '';
                nextButton.classList.add('hidden');

                // –ü–æ–≤—ã—à–∞–µ–º —É—Ä–æ–≤–µ–Ω—å –∫–∞–∂–¥—ã–µ 5 –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
                if (score >= level * 50) {
                    level++;
                    levelElement.textContent = level;
                    feedbackText.textContent = `–£—Ä–∞! –¢—ã –¥–æ—Å—Ç–∏–≥ —É—Ä–æ–≤–Ω—è ${level}!`;
                    setTimeout(() => {
                        feedbackText.textContent = '';
                        generateQuestion();
                    }, 1500);
                } else {
                    generateQuestion();
                }
            }

            function updateScore() {
                scoreElement.textContent = score;
            }

            function toggleHelp() {
                helpText.classList.toggle('hidden');
            }

            // –§—É–Ω–∫—Ü–∏—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Ñ–∞–∫—Ç–æ—Ä–∏–∞–ª–∞
            function calculateFactorial(n) {
                if (n === 0 || n === 1) return 1;
                let result = 1;
                for (let i = 2; i <= n; i++) {
                    result *= i;
                }
                return result;
            }

            // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            function getRandomSuccessMessage() {
                const messages = [
                    "–í–µ—Ä–Ω–æ! –¢—ã —Ñ–∞–∫—Ç–æ—Ä–∏–∞–ª—å–Ω—ã–π –≥–µ–Ω–∏–π!",
                    "–ü—Ä–∞–≤–∏–ª—å–Ω–æ! –£–º–Ω–æ–∂–µ–Ω–∏–µ - —Ç–≤–æ—è —Å—É–ø–µ—Ä—Å–∏–ª–∞!",
                    "–û—Ç–ª–∏—á–Ω–æ! –¢—ã –º–∞—Å—Ç–µ—Ä —Ñ–∞–∫—Ç–æ—Ä–∏–∞–ª–æ–≤!",
                    "–°—É–ø–µ—Ä! –¢—ã —Ä–µ—à–∏–ª —ç—Ç–æ –∫–∞–∫ –ø—Ä–æ—Ñ–µ—Å—Å–æ—Ä –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏!",
                    "–ë—Ä–∞–≤–æ! –§–∞–∫—Ç–æ—Ä–∏–∞–ª—ã —Ç–µ–±–µ –ø–æ –ø–ª–µ—á—É!",
                    "–í–µ–ª–∏–∫–æ–ª–µ–ø–Ω–æ! –¢—ã —É–º–Ω–æ–∂–∞–µ—à—å –∫–∞–∫ –∫–æ–º–ø—å—é—Ç–µ—Ä!"
                ];
                return messages[Math.floor(Math.random() * messages.length)];
            }

            function getRandomHint() {
                const hints = [
                    `–ü–æ–º–Ω–∏: ${currentNumber}! - —ç—Ç–æ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –≤—Å–µ—Ö —á–∏—Å–µ–ª –æ—Ç 1 –¥–æ ${currentNumber}.`,
                    "–ü–æ–ø—Ä–æ–±—É–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ —É–º–Ω–æ–∂–∞—Ç—å —á–∏—Å–ª–∞ –æ—Ç 1 –¥–æ N!",
                    "–ù–µ –ø–µ—Ä–µ–∂–∏–≤–∞–π, –≤ —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑ –ø–æ–ª—É—á–∏—Ç—Å—è!",
                    "–î–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –º–æ–∂–µ—à—å –∑–∞–ø–∏—Å–∞—Ç—å –≤—Å–µ —á–∏—Å–ª–∞ –æ—Ç 1 –¥–æ N –∏ –ø–µ—Ä–µ–º–Ω–æ–∂–∏—Ç—å –∏—Ö.",
                    "–ï—Å–ª–∏ –∑–∞–±—ã–ª, –º–æ–∂–µ—à—å –Ω–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É '–ü–æ–º–æ—â—å' –∏–ª–∏ '–ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ—à–µ–Ω–∏–µ'!"
                ];
                return hints[Math.floor(Math.random() * hints.length)];
            }
        });
    </script>
    <script>
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –¥–æ—Å—Ç—É–ø
        if (localStorage.getItem("accessGranted") !== "true") {
            window.location.href = "index.html";
        }
    </script>
</body>

</html>
